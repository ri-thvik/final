<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RapidRide - Book Your Ride</title>
    <link rel="stylesheet" href="css/rider.css">
    <link rel="stylesheet" href="css/map-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>

<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <i class="fas fa-bolt"></i>
            </div>
            <h1 class="splash-title">RapidRide</h1>
            <p class="splash-tagline">Your ride, your way</p>
            <div class="splash-loader"></div>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <h1>Welcome to RapidRide</h1>
                <p>Enter your phone number to continue</p>
            </div>

            <div class="auth-form">
                <div class="input-group">
                    <div class="input-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <input type="tel" id="phone" placeholder="Phone Number" maxlength="10">
                </div>

                <div class="input-group" id="name-group" style="display: none;">
                    <div class="input-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <input type="text" id="name" placeholder="Full Name">
                </div>

                <button class="btn-primary" id="auth-btn" onclick="handleAuth()">
                    <span>Continue</span>
                    <i class="fas fa-arrow-right"></i>
                </button>

                <p class="auth-footer">
                    By continuing, you agree to our Terms & Privacy Policy
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="main-screen" class="screen" style="display: none;">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="menu-btn" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="user-info">
                <span id="user-name">User</span>
            </div>
        </div>

        <!-- Side Menu Overlay -->
        <div class="side-menu-overlay" id="side-menu-overlay" onclick="toggleMenu()"></div>

        <!-- Side Menu -->
        <div class="side-menu" id="side-menu">
            <div class="menu-header">
                <div class="menu-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="menu-user-info">
                    <h3 id="menu-user-name">User</h3>
                    <p id="menu-user-phone">+91 XXXXXXXXXX</p>
                </div>
            </div>
            <div class="menu-items">
                <a href="#" class="menu-item" onclick="showTripHistory(); return false;">
                    <i class="fas fa-history"></i>
                    <span>Your Trips</span>
                </a>
                <a href="#" class="menu-item" onclick="showProfile(); return false;">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="#" class="menu-item" onclick="showWallet(); return false;">
                    <i class="fas fa-wallet"></i>
                    <span>Wallet</span>
                </a>
                <a href="#" class="menu-item" onclick="showSavedAddresses(); return false;">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Saved Places</span>
                </a>
                <a href="#" class="menu-item" onclick="showNotifications(); return false;">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                </a>
                <a href="#" class="menu-item" onclick="showHelp(); return false;">
                    <i class="fas fa-headset"></i>
                    <span>Help & Support</span>
                </a>
                <a href="#" class="menu-item" onclick="showSettings(); return false;">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="menu-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Map Container -->
        <div id="map-container" class="map-container">
            <div id="map"></div>

            <!-- Current Location Button -->
            <button class="current-location-btn" onclick="getCurrentLocation()">
                <i class="fas fa-location-crosshairs"></i>
            </button>
        </div>

        <!-- Bottom Sheet - Location Input -->
        <div class="bottom-sheet" id="location-sheet">
            <div class="sheet-handle"></div>

            <div class="location-inputs">
                <div class="location-input-group">
                    <div class="location-dot pickup-dot"></div>
                    <input type="text" id="pickup-input" placeholder="Pickup location" readonly
                        onclick="openLocationSearch('pickup')">
                    <button class="location-clear" onclick="clearLocation('pickup')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="location-divider"></div>

                <div class="location-input-group">
                    <div class="location-dot drop-dot"></div>
                    <input type="text" id="drop-input" placeholder="Where to?" onclick="openLocationSearch('drop')">
                    <button class="location-clear" onclick="clearLocation('drop')" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Saved Places -->
            <div class="saved-places">
                <div class="saved-place" onclick="selectSavedPlace('home')">
                    <div class="saved-place-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="saved-place-info">
                        <h4>Home</h4>
                        <p>Add your home address</p>
                    </div>
                </div>
                <div class="saved-place" onclick="selectSavedPlace('work')">
                    <div class="saved-place-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="saved-place-info">
                        <h4>Work</h4>
                        <p>Add your work address</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Sheet - Vehicle Selection -->
        <div class="bottom-sheet vehicle-sheet" id="vehicle-sheet" style="display: none;">
            <div class="sheet-handle"></div>

            <h3 class="sheet-title">Choose a ride</h3>

            <div class="vehicle-options">
                <div class="vehicle-option" data-type="bike" onclick="selectVehicle('bike')">
                    <div class="vehicle-icon">
                        <i class="fas fa-motorcycle"></i>
                    </div>
                    <div class="vehicle-info">
                        <h4>Bike</h4>
                        <p><i class="fas fa-user"></i> 1 seat</p>
                        <p class="vehicle-time">2 mins away</p>
                    </div>
                    <div class="vehicle-price">
                        <span class="price">₹<span class="price-amount">45</span></span>
                    </div>
                </div>

                <div class="vehicle-option" data-type="auto" onclick="selectVehicle('auto')">
                    <div class="vehicle-icon">
                        <i class="fas fa-taxi"></i>
                    </div>
                    <div class="vehicle-info">
                        <h4>Auto</h4>
                        <p><i class="fas fa-user"></i> 3 seats</p>
                        <p class="vehicle-time">3 mins away</p>
                    </div>
                    <div class="vehicle-price">
                        <span class="price">₹<span class="price-amount">78</span></span>
                    </div>
                </div>

                <div class="vehicle-option" data-type="car" onclick="selectVehicle('car')">
                    <div class="vehicle-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="vehicle-info">
                        <h4>Car</h4>
                        <p><i class="fas fa-user"></i> 4 seats</p>
                        <p class="vehicle-time">5 mins away</p>
                    </div>
                    <div class="vehicle-price">
                        <span class="price">₹<span class="price-amount">125</span></span>
                    </div>
                </div>
            </div>

            <button class="btn-primary btn-book" onclick="confirmBooking()">
                <span>Confirm Booking</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- Bottom Sheet - Searching Driver -->
        <div class="bottom-sheet searching-sheet" id="searching-sheet" style="display: none;">
            <div class="sheet-handle"></div>

            <div class="searching-content">
                <div class="searching-animation">
                    <div class="pulse-ring"></div>
                    <div class="pulse-ring delay-1"></div>
                    <div class="pulse-ring delay-2"></div>
                    <i class="fas fa-search"></i>
                </div>
                <h3>Finding your ride...</h3>
                <p>Please wait while we connect you with a driver</p>
            </div>

            <button class="btn-secondary" onclick="cancelSearch()">
                Cancel
            </button>
        </div>

        <!-- Bottom Sheet - Driver Found -->
        <div class="bottom-sheet driver-sheet" id="driver-sheet" style="display: none;">
            <div class="sheet-handle"></div>

            <div class="driver-info-card">
                <div class="driver-header">
                    <div class="driver-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="driver-details">
                        <h3 id="driver-name">Driver Name</h3>
                        <div class="driver-rating">
                            <i class="fas fa-star"></i>
                            <span id="driver-rating">4.8</span>
                        </div>
                    </div>
                    <div class="driver-actions">
                        <button class="icon-btn" onclick="callDriver()">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="icon-btn" onclick="chatDriver()">
                            <i class="fas fa-comment"></i>
                        </button>
                    </div>
                </div>

                <div class="vehicle-details">
                    <div class="vehicle-detail-item">
                        <i class="fas fa-car"></i>
                        <span id="vehicle-model">Honda City</span>
                    </div>
                    <div class="vehicle-detail-item">
                        <i class="fas fa-hashtag"></i>
                        <span id="vehicle-number">KA 01 AB 1234</span>
                    </div>
                </div>

                <div class="trip-status">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span id="trip-status-text">Driver is arriving</span>
                    </div>
                    <div class="eta">
                        <i class="fas fa-clock"></i>
                        <span id="driver-eta">3 mins</span>
                    </div>
                </div>

                <div class="otp-section" id="otp-section" style="display: none;">
                    <p>Share this OTP with driver</p>
                    <div class="otp-display">
                        <span id="trip-otp">1234</span>
                    </div>
                </div>
            </div>

            <button class="btn-danger" onclick="cancelTrip()">
                Cancel Trip
            </button>
        </div>
    </div>

    <!-- Location Search Modal -->
    <div class="modal" id="location-search-modal" style="display: none;">
        <div class="modal-content location-search">
            <div class="search-header">
                <button class="back-btn" onclick="closeLocationSearch()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="location-search-input" placeholder="Search location"
                        oninput="searchLocation(event)">
                </div>
            </div>

            <div class="search-results" id="search-results">
                <div class="search-result-item" onclick="selectCurrentLocation()">
                    <i class="fas fa-location-crosshairs"></i>
                    <div class="result-info">
                        <h4>Current Location</h4>
                        <p>Use my current location</p>
                    </div>
                </div>
                <!-- Search results will be populated here -->
            </div>
        </div>
    </div>

    <!-- Trip History Modal -->
    <div class="modal" id="trip-history-modal" style="display: none;">
        <div class="modal-content trip-history-modal">
            <div class="modal-header">
                <h2>Your Trips</h2>
                <button class="close-btn" onclick="closeTripHistory()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="trip-history-content" id="trip-history-content">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading trips...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profile-modal" style="display: none;">
        <div class="modal-content profile-modal">
            <div class="modal-header">
                <h2>Profile</h2>
                <button class="close-btn" onclick="closeProfile()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="profile-content" id="profile-content"></div>
        </div>
    </div>

    <!-- Wallet Modal -->
    <div class="modal" id="wallet-modal" style="display: none;">
        <div class="modal-content wallet-modal">
            <div class="modal-header">
                <h2>Wallet</h2>
                <button class="close-btn" onclick="closeWallet()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="wallet-content" id="wallet-content"></div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div class="modal" id="rating-modal" style="display: none;">
        <div class="modal-content rating-modal">
            <div class="rating-header">
                <h2>Rate your trip</h2>
                <p>How was your experience?</p>
            </div>
            <div class="rating-content">
                <div class="star-rating" id="star-rating">
                    <i class="far fa-star" data-rating="1"></i>
                    <i class="far fa-star" data-rating="2"></i>
                    <i class="far fa-star" data-rating="3"></i>
                    <i class="far fa-star" data-rating="4"></i>
                    <i class="far fa-star" data-rating="5"></i>
                </div>
                <textarea id="rating-review" placeholder="Share your feedback (optional)" maxlength="500"></textarea>
                <div class="rating-actions">
                    <button class="btn-secondary" onclick="closeRatingModal()">Skip</button>
                    <button class="btn-primary" onclick="submitRating()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notifications-modal" style="display: none;">
        <div class="modal-content notifications-modal">
            <div class="modal-header">
                <h2>Notifications</h2>
                <button class="close-btn" onclick="closeNotifications()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notifications-content" id="notifications-content"></div>
        </div>
    </div>

    <!-- Help & Support Modal -->
    <div class="modal" id="help-modal" style="display: none;">
        <div class="modal-content help-modal">
            <div class="modal-header">
                <h2>Help & Support</h2>
                <button class="close-btn" onclick="closeHelp()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="help-content" id="help-content"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal" style="display: none;">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" onclick="closeSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-content" id="settings-content"></div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/maps.js"></script>
    <script src="js/rider.js"></script>
    <link rel="stylesheet" href="css/utils.css">
    <link rel="stylesheet" href="css/modals.css">
</body>

</html>